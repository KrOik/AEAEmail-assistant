<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阿里云百炼API测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 150px;
            font-family: monospace;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .error {
            background-color: #f2dede;
            color: #a94442;
        }
        .info {
            background-color: #d9edf7;
            color: #31708f;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #ddd;
            background-color: #f1f1f1;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
        }
        .tab-content {
            display: none;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 0 4px 4px 4px;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>阿里云百炼API测试工具</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="direct">直接调用</div>
        <div class="tab" data-tab="netlify">通过Netlify函数调用</div>
        <div class="tab" data-tab="info">API信息</div>
    </div>
    
    <div id="direct" class="tab-content active">
        <div class="container">
            <h2>直接调用阿里云百炼API</h2>
            <div class="form-group">
                <label for="direct-api-key">API密钥：</label>
                <input type="text" id="direct-api-key" placeholder="输入你的阿里云百炼API密钥">
            </div>
            <div class="form-group">
                <label for="direct-api-url">API端点URL：</label>
                <input type="text" id="direct-api-url" value="https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions">
            </div>
            <div class="form-group">
                <label for="direct-model">模型：</label>
                <select id="direct-model">
                    <option value="qwen-max">qwen-max</option>
                    <option value="qwen-plus">qwen-plus</option>
                    <option value="qwen-turbo">qwen-turbo</option>
                </select>
            </div>
            <div class="form-group">
                <label for="direct-prompt">提示词：</label>
                <textarea id="direct-prompt">你好，请回复"API测试成功！"</textarea>
            </div>
            <button id="direct-test-btn">测试API</button>
        </div>
        
        <div class="status info" id="direct-status">准备就绪，点击测试按钮开始测试</div>
        
        <h3>响应结果：</h3>
        <pre id="direct-result">等待测试...</pre>
    </div>
    
    <div id="netlify" class="tab-content">
        <div class="container">
            <h2>通过Netlify函数调用API</h2>
            <div class="form-group">
                <label for="netlify-function-url">Netlify函数URL：</label>
                <input type="text" id="netlify-function-url" value="/.netlify/functions/api">
            </div>
            <div class="form-group">
                <label for="netlify-model">模型：</label>
                <select id="netlify-model">
                    <option value="qwen-max">qwen-max</option>
                    <option value="qwen-plus">qwen-plus</option>
                    <option value="qwen-turbo">qwen-turbo</option>
                </select>
            </div>
            <div class="form-group">
                <label for="netlify-prompt">提示词：</label>
                <textarea id="netlify-prompt">你好，请回复"Netlify函数API测试成功！"</textarea>
            </div>
            <button id="netlify-test-btn">测试Netlify函数</button>
        </div>
        
        <div class="status info" id="netlify-status">准备就绪，点击测试按钮开始测试</div>
        
        <h3>响应结果：</h3>
        <pre id="netlify-result">等待测试...</pre>
    </div>
    
    <div id="info" class="tab-content">
        <div class="container">
            <h2>阿里云百炼API信息</h2>
            <p>阿里云百炼提供了OpenAI兼容接口，可以通过调整API Key和BASE_URL来使用通义千问模型。</p>
            
            <h3>API端点</h3>
            <pre>https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions</pre>
            
            <h3>请求格式</h3>
            <pre>{
  "model": "qwen-max",  // 可选：qwen-max, qwen-plus, qwen-turbo等
  "messages": [
    {"role": "system", "content": "系统提示"},
    {"role": "user", "content": "用户消息"}
  ],
  "max_tokens": 2000,
  "temperature": 0.7
}</pre>
            
            <h3>认证方式</h3>
            <p>在请求头中添加：<code>Authorization: Bearer YOUR_API_KEY</code></p>
            
            <h3>常见问题</h3>
            <ul>
                <li>确保API_URL格式正确，必须以<code>/chat/completions</code>结尾</li>
                <li>检查API密钥是否有效且未过期</li>
                <li>确保请求体格式符合OpenAI兼容接口规范</li>
                <li>如遇到CORS错误，需要通过服务器端代理（如Netlify函数）进行API调用</li>
            </ul>
        </div>
    </div>

    <script>
        // 切换标签页
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // 直接调用API
        document.getElementById('direct-test-btn').addEventListener('click', async () => {
            const apiKey = document.getElementById('direct-api-key').value;
            const apiUrl = document.getElementById('direct-api-url').value;
            const model = document.getElementById('direct-model').value;
            const prompt = document.getElementById('direct-prompt').value;
            
            const statusEl = document.getElementById('direct-status');
            const resultEl = document.getElementById('direct-result');
            
            if (!apiKey) {
                statusEl.className = 'status error';
                statusEl.textContent = '错误：请输入API密钥';
                return;
            }
            
            statusEl.className = 'status info';
            statusEl.textContent = '正在调用API...';
            resultEl.textContent = '请求中...';
            
            try {
                const startTime = new Date();
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {role: 'user', content: prompt}
                        ],
                        max_tokens: 100,
                        temperature: 0.7
                    })
                });
                
                const endTime = new Date();
                const duration = (endTime - startTime) / 1000;
                
                const responseText = await response.text();
                
                try {
                    const data = JSON.parse(responseText);
                    resultEl.textContent = JSON.stringify(data, null, 2);
                    
                    if (response.ok) {
                        statusEl.className = 'status success';
                        statusEl.textContent = `成功！请求耗时：${duration.toFixed(2)}秒`;
                    } else {
                        statusEl.className = 'status error';
                        statusEl.textContent = `错误 (${response.status}): ${data.error?.message || '未知错误'}`;
                    }
                } catch (e) {
                    resultEl.textContent = responseText;
                    statusEl.className = 'status error';
                    statusEl.textContent = `解析响应失败：${e.message}`;
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `请求失败：${error.message}`;
                resultEl.textContent = `错误：${error.message}`;
            }
        });
        
        // 通过Netlify函数调用API
        document.getElementById('netlify-test-btn').addEventListener('click', async () => {
            const functionUrl = document.getElementById('netlify-function-url').value;
            const model = document.getElementById('netlify-model').value;
            const prompt = document.getElementById('netlify-prompt').value;
            
            const statusEl = document.getElementById('netlify-status');
            const resultEl = document.getElementById('netlify-result');
            
            statusEl.className = 'status info';
            statusEl.textContent = '正在调用Netlify函数...';
            resultEl.textContent = '请求中...';
            
            try {
                const startTime = new Date();
                
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {role: 'user', content: prompt}
                        ],
                        max_tokens: 100,
                        temperature: 0.7
                    })
                });
                
                const endTime = new Date();
                const duration = (endTime - startTime) / 1000;
                
                const responseText = await response.text();
                
                try {
                    const data = JSON.parse(responseText);
                    resultEl.textContent = JSON.stringify(data, null, 2);
                    
                    if (response.ok) {
                        statusEl.className = 'status success';
                        statusEl.textContent = `成功！请求耗时：${duration.toFixed(2)}秒`;
                    } else {
                        statusEl.className = 'status error';
                        statusEl.textContent = `错误 (${response.status}): ${data.error || '未知错误'}`;
                    }
                } catch (e) {
                    resultEl.textContent = responseText;
                    statusEl.className = 'status error';
                    statusEl.textContent = `解析响应失败：${e.message}`;
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `请求失败：${error.message}`;
                resultEl.textContent = `错误：${error.message}`;
            }
        });
    </script>
</body>
</html>